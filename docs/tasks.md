開発はUnity 2022 LTS＋VCC＋SDK3 Worlds＋UdonSharpの標準構成で、PlayerData中心の設計と「外部連携なし」を徹底し、イベント駆動の**増分再計算**と6軸縮約の**在室同期**を核に実装と検証を進める流れになる。[1][2]
ブランチ戦略と受入基準を前提に、Claude Code 主導の feature ブランチ駆動で「診断→ベクトル算出→公開同期→推薦→1on1」の体験を段階的に仕上げ、NFR（FPS・サイズ・全再計算時間）を満たすまで回帰・負荷検証を繰り返すことになる。[3][4][5][1]

## 全体像
- 単一ワールド内完結・**外部連携なし**で、自己データはPlayerDataにのみ永続化し、公開は在室同意者の縮約データに限定するため、実装はSDK3 Worlds＋UdonSharpの範囲に収まる設計となる。[4][2]
- ランタイムは回答確定・入退室・公開ON/OFFをトリガに、30D暫定ベクトル更新→6D縮約→同期→類似度再計算→上位3件UI更新のイベント鎖で駆動し、PerfGuardで1フレームあたりの演算上限Kを管理する流れになる。[2][4]

## フェーズ計画
- フェーズ0（環境・雛形）：Ubuntu 22.04上でUnity Hub＋Unity 2022 LTSを導入し、VCCのSDK3 WorldsテンプレにUdonSharpを追加、VCC管理のmanifest固定とプラットフォーム切替のビルド前提を確立する。[1][2]
- フェーズ1（SO整備）：112問・重み行列W・投影P・要約テンプレ・性能パラメータKをScriptableObject化し、ビルドレス調整の運用を作る。[5][2]
- フェーズ2（診断・保存）：DiagnosisControllerとPlayerDataManagerで「逐次保存・中断再開・未回答=0・最後の未回答へ復帰」を成立させる。[3][2]
- フェーズ3（ベクトル算出）：VectorBuilderで回答ごとの暫定30D更新と完了時の正規化確定保存（-1..+1）を実装する。[2][3]
- フェーズ4（公開同期）：PublicProfilePublisherで30→6軸縮約、tags/headline/display_name、partial_flag/progressの同期配布と公開OFF即時クリアを実装する。[3][2]
- フェーズ5（推薦UI）：CompatibilityCalculatorで6Dコサイン類似度を分散計算し、RecommenderUIで上位3件カードと詳細UI・招待ボタン・暫定バッジ・進捗表示を仕上げる。[4][2]
- フェーズ6（1on1）：SessionRoomManagerで双方同意→個室割当→テレポ→15分タイマー→帰還→フィードバック記録を通す。[4][2]
- フェーズ7（性能・受入）：PC/QuestでFPS・サイズ・全再計算時間のNFRを満たすまでPerfGuard調整・焼き込み・共有マテリアル・テクスチャ上限などを追い込み、受入基準を通過させる。[1][3]


総評として、現状の設計と実装は「単一ワールド内完結・6軸縮約・イベント駆動」の方針に忠実で、データ設計とSO外部化・増分再計算・パフォーマンス目標が整合している一方、同期/所有権の数値規約、位置/個室の占有制御、復旧とCIの機械化、Projection Pの一貫利用などVRChat固有の運用粒度に不足が見られる。[1][2][3][4]
本レビューは日本語で記載し、Ubuntu 22.04・Unity 2022 LTS・Claude Codeの前提を踏まえ、開発運用まで横断的に改善提案をまとめる。[5][6][7][1]

## 設計の強み
- 在室者限定の公開データと6軸縮約、イベント駆動の増分再計算、1on1の15分タイマーまでのフローが要件と一致しており、セキュリティ/プライバシー方針も一貫している。[2][4]
- UdonSharpコンポーネント分割（PlayerDataManager/VectorBuilder/PublicProfilePublisher/CompatibilityCalculator/PerfGuardなど）と責務境界の明記により、拡張時の回帰影響が抑制される設計である。[3][4]

## 主要な不足・リスク
- 同期/所有権・帯域設計の数値基準（RequestSerialization頻度、同期ペイロード上限、優先度キュー）が未定義で、ピーク時やLate-joiner時の破綻リスクが残る。[1][3]
- 位置/個室の空間設計（テレポート先アンカー、Station運用、占有テーブル、音漏れ/視界分離）の規約化が未整備で、誤入室や音漏れ・描画干渉の可能性がある。[4][3]

## コードレビュー（SO/設定）
- QuestionDatabaseはOnValidateで112固定・choices/weightsの初期化を行い、ValidateDatabaseで整合検査する構造が健全である。[8]
- SummaryTemplatesは軸ごとの正負/中立の説明とタグ生成、見出しテンプレの信頼度しきい値選択が明確だが、minConfidenceの選択は先勝ちのため、最適テンプレ探索の順序やスコアリング基準を明文化すると安定する。[9]
- VectorConfigurationはWとPの取得/設定と軸名ラベル、正規化εの管理をSO化しており、Projection Pを計算系全体で一貫使用できる前提が整っている。[10]

## コードレビュー（PlayerDataManager）
- 112問の逐次保存・進捗加算・単項目即時保存・配列コピーによる不変返却など、信頼性重視の構造が取られている。[7]
- DateTime.Ticks/1e7のコメントが「Unix近似」とされているが実際は西暦0001起点であり、絶対時刻に依存しない相対カウンタ運用か、設計どおり「在室イベント駆動」での時刻不要化を検討するとよい。[3][7]
- Reset時のキー全消去やLoad/Saveの例外処理＋再試行は妥当だが、ロード未完了時の他コンポーネント起動順とイベント発火順（onDataLoaded）を設計ドキュメントに合流させると再現性が高まる。[4][7]

## コードレビュー（CompatibilityCalculator）
- PerfGuardを介した分散計算・フレーム予算順守と、Similarity/Confidence/暫定フラグ/進捗％の結果構造は、暫定マッチングの要件に合致している。[11][4]
- 6DへのReduceTo6Dが「5軸平均」による暫定実装で、設計の固定投影P（SO化）と乖離しているため、VectorConfigurationのPを用いた縮約に置き換えて整合性とLate-joiner一貫性を確保したい。[11][10]
- プロファイル列挙はFindObjectsOfTypeベースで簡明だが、Owner/IsPublic検査の条件式と除外（自分自身）を明文化し、進捗イベント発火時のデバウンス/レート制御を追加すると帯域に優しい。[3][11]

## 同期・所有権・帯域
- 同期変数は最小・Owner制御・RequestSerializationの呼出点限定という方針は明示済みだが、Hz上限・ペイロードkb/秒・優先度（招待/占有＞公開6軸＞UI）などの数値規約をarchitecture.mdに追記するべきである。[1][3]
- 公開OFF・退室・データ未整合時の即時クリアは設計済みであるため、OnDeserializationの適用順とLate-joiner初期化の待ち時間（プレースホルダ表示）をworld空間設計に合わせて定義したい。[4][3]

## 空間設計と個室
- 入口→広間→個室→帰還の一方向導線と、個室の占有/予約/解放の状態遷移をworldspacedesign.mdに明文化し、Station/アンカー命名規約と誤テレポ抑止（クールダウン）を規約化すると安全である。[3][4]
- 1on1の遮音・視界遮蔽・ベルの聴取範囲は個室内に限定し、ロビーとはオクルージョン＋レンダラー切替で描画干渉を最小化する。[1][4]

## NFR/パフォーマンス
- 目標（PC≥72FPS/Quest≥60FPS、PC<200MB/Quest<100MB、全再計算PC≤5秒・Quest≤10秒）に対し、PerformanceSettingsのK/頻度/解像度上限のSO化は運用に有効である。[6][2]
- 個室/ロビー別の描画・同期・計算予算を表にして、CIで容量・ドローコール・同期頻度の閾値を検査し、閾値超過でビルドを停止する品質ゲートをdevenv.mdに追記したい。[2][1]

## テスト/運用/CI
- ローカル複窓とFriends+での結合/負荷/回帰は明記済みだが、Late-joiner整合、満室/同時招待、片方離脱、公開連打、落下/復帰など位置・同期系のシナリオをテスト項目として列挙すると漏れを防げる。[1][3]
- PR自己点検に加え、ビルドサイズ・フレーム時間・同期送出回数・再計算遅延の自動レポートをCIで生成し、受入基準（NFR/露出ゼロ/上位3件）へのトレースを自動化するのが望ましい。[2][1]

## セキュリティ/プライバシー/UX
- 生回答・30軸非公開、6軸縮約＋要約＋進捗のみ公開、公開OFF即時クリアは堅牢であるが、ブロック/ミュート/拒否の導線を空間UIに常設し、招待連打や個室押し込みにクールダウンを課す設計が必要である。[2][4]
- 暫定表示の説明性は確保されているため、ランキングの過度な揺れを抑えるデバウンス/ヒステリシスと、信頼度メーターの視覚言語を追加すると体験が安定する。[4][2]

## 優先アクション（推奨）
- CompatibilityCalculatorをProjection P利用に変更し、VectorConfiguration依存に統一（ReduceTo6D暫定実装を廃止）。[10][11]
- worldspacedesign.mdを新設し、テレポ先アンカー/Station/占有状態/遮音・視界分離/復帰動線/クールダウンを規約化（テストケースも併記）。[3][4]
- architecture.mdに同期/所有権の数値規約（Hz/KB・優先度キュー・OnDeserialization順序・Late-joiner表示）を追記。[1][3]
- CIで容量・ドロー・同期頻度・再計算遅延の自動検査を追加し、受入基準へのトレースをPRに自動添付。