Assets\VirtualTokyoMatching\ScriptableObjects\QuestionDatabase.cs(26,10): error CS0592: Attribute 'Header' is not valid on this declaration type. It is only valid on 'field' declarations.

Assets\VirtualTokyoMatching\Tests\Matching\ProgressiveMatchingTests.cs(821,42): error CS1109: Extension methods must be defined in a top level static class; EnumerableExtensions is a nested class

Assets\VirtualTokyoMatching\Tests\Matching\ProgressiveMatchingTests.cs(831,29): error CS1109: Extension methods must be defined in a top level static class; EnumerableExtensions is a nested class

Assets\VirtualTokyoMatching\Tests\Matching\ProgressiveMatchingTests.cs(838,29): error CS1109: Extension methods must be defined in a top level static class; EnumerableExtensions is a nested class

Assets\VirtualTokyoMatching\Tests\Matching\ProgressiveMatchingTests.cs(848,33): error CS1109: Extension methods must be defined in a top level static class; EnumerableExtensions is a nested class

Assets\VirtualTokyoMatching\Tests\Matching\ProgressiveMatchingTests.cs(860,32): error CS1109: Extension methods must be defined in a top level static class; EnumerableExtensions is a nested class

Assets\VirtualTokyoMatching\Tests\Matching\ProgressiveMatchingTests.cs(870,32): error CS1109: Extension methods must be defined in a top level static class; EnumerableExtensions is a nested class

Assets\VirtualTokyoMatching\Tests\Matching\ProgressiveMatchingTests.cs(880,35): error CS1109: Extension methods must be defined in a top level static class; EnumerableExtensions is a nested class

Assets\VirtualTokyoMatching\Tests\Matching\ProgressiveMatchingTests.cs(890,48): error CS1109: Extension methods must be defined in a top level static class; EnumerableExtensions is a nested class

Assets\VirtualTokyoMatching\Tests\Matching\ProgressiveMatchingTests.cs(898,42): error CS1109: Extension methods must be defined in a top level static class; EnumerableExtensions is a nested class

Assets\VirtualTokyoMatching\Tests\Matching\ProgressiveMatchingTests.cs(921,31): error CS1109: Extension methods must be defined in a top level static class; EnumerableExtensions is a nested class

Assets\VirtualTokyoMatching\Tests\Sync\MultiUserSynchronizationTests.cs(691,42): error CS1109: Extension methods must be defined in a top level static class; EnumerableExtensions is a nested class

Assets\VirtualTokyoMatching\Tests\Sync\MultiUserSynchronizationTests.cs(702,42): error CS1109: Extension methods must be defined in a top level static class; EnumerableExtensions is a nested class

Assets\VirtualTokyoMatching\Tests\Sync\MultiUserSynchronizationTests.cs(716,29): error CS1109: Extension methods must be defined in a top level static class; EnumerableExtensions is a nested class

Assets\VirtualTokyoMatching\Tests\Sync\MultiUserSynchronizationTests.cs(725,29): error CS1109: Extension methods must be defined in a top level static class; EnumerableExtensions is a nested class

Assets\VirtualTokyoMatching\Tests\Sync\MultiUserSynchronizationTests.cs(748,29): error CS1109: Extension methods must be defined in a top level static class; EnumerableExtensions is a nested class

Assets\VirtualTokyoMatching\Tests\Matching\ProgressiveMatchingTests.cs(402,10): error CS0246: The type or namespace name 'UnityTestAttribute' could not be found (are you missing a using directive or an assembly reference?)

Assets\VirtualTokyoMatching\Tests\Matching\ProgressiveMatchingTests.cs(402,10): error CS0246: The type or namespace name 'UnityTest' could not be found (are you missing a using directive or an assembly reference?)

Assets\VirtualTokyoMatching\Tests\Performance\PerfGuardTests.cs(101,10): error CS0246: The type or namespace name 'UnityTestAttribute' could not be found (are you missing a using directive or an assembly reference?)

Assets\VirtualTokyoMatching\Tests\Performance\PerfGuardTests.cs(101,10): error CS0246: The type or namespace name 'UnityTest' could not be found (are you missing a using directive or an assembly reference?)

Assets\VirtualTokyoMatching\Tests\Sync\MultiUserSynchronizationTests.cs(771,31): error CS1109: Extension methods must be defined in a top level static class; EnumerableExtensions is a nested class

Assets\VirtualTokyoMatching\Tests\Sync\MultiUserSynchronizationTests.cs(782,31): error CS1109: Extension methods must be defined in a top level static class; EnumerableExtensions is a nested class

Assets\VirtualTokyoMatching\Tests\Performance\PerformanceBenchmarkSuite.cs(191,10): error CS0246: The type or namespace name 'UnityTestAttribute' could not be found (are you missing a using directive or an assembly reference?)

Assets\VirtualTokyoMatching\Tests\Performance\PerformanceBenchmarkSuite.cs(191,10): error CS0246: The type or namespace name 'UnityTest' could not be found (are you missing a using directive or an assembly reference?)

Assets\VirtualTokyoMatching\Tests\Matching\ProgressiveMatchingTests.cs(544,10): error CS0246: The type or namespace name 'UnityTestAttribute' could not be found (are you missing a using directive or an assembly reference?)

Assets\VirtualTokyoMatching\Tests\Matching\ProgressiveMatchingTests.cs(544,10): error CS0246: The type or namespace name 'UnityTest' could not be found (are you missing a using directive or an assembly reference?)

Assets\VirtualTokyoMatching\Tests\Performance\PerformanceBenchmarkSuite.cs(285,10): error CS0246: The type or namespace name 'UnityTestAttribute' could not be found (are you missing a using directive or an assembly reference?)

Assets\VirtualTokyoMatching\Tests\Performance\PerformanceBenchmarkSuite.cs(285,10): error CS0246: The type or namespace name 'UnityTest' could not be found (are you missing a using directive or an assembly reference?)

Assets\VirtualTokyoMatching\Tests\Performance\PerfGuardTests.cs(287,10): error CS0246: The type or namespace name 'UnityTestAttribute' could not be found (are you missing a using directive or an assembly reference?)

Assets\VirtualTokyoMatching\Tests\Performance\PerfGuardTests.cs(287,10): error CS0246: The type or namespace name 'UnityTest' could not be found (are you missing a using directive or an assembly reference?)

Assets\VirtualTokyoMatching\Tests\Matching\ProgressiveMatchingTests.cs(594,10): error CS0246: The type or namespace name 'UnityTestAttribute' could not be found (are you missing a using directive or an assembly reference?)

Assets\VirtualTokyoMatching\Tests\Matching\ProgressiveMatchingTests.cs(594,10): error CS0246: The type or namespace name 'UnityTest' could not be found (are you missing a using directive or an assembly reference?)

Assets\VirtualTokyoMatching\Tests\Sync\MultiUserSynchronizationTests.cs(205,10): error CS0246: The type or namespace name 'UnityTestAttribute' could not be found (are you missing a using directive or an assembly reference?)

Assets\VirtualTokyoMatching\Tests\Sync\MultiUserSynchronizationTests.cs(205,10): error CS0246: The type or namespace name 'UnityTest' could not be found (are you missing a using directive or an assembly reference?)

Assets\VirtualTokyoMatching\Tests\Performance\PerfGuardTests.cs(334,10): error CS0246: The type or namespace name 'UnityTestAttribute' could not be found (are you missing a using directive or an assembly reference?)

Assets\VirtualTokyoMatching\Tests\Performance\PerfGuardTests.cs(334,10): error CS0246: The type or namespace name 'UnityTest' could not be found (are you missing a using directive or an assembly reference?)

Assets\VirtualTokyoMatching\Tests\Sync\MultiUserSynchronizationTests.cs(247,10): error CS0246: The type or namespace name 'UnityTestAttribute' could not be found (are you missing a using directive or an assembly reference?)

Assets\VirtualTokyoMatching\Tests\Sync\MultiUserSynchronizationTests.cs(247,10): error CS0246: The type or namespace name 'UnityTest' could not be found (are you missing a using directive or an assembly reference?)

Assets\VirtualTokyoMatching\Tests\Sync\MultiUserSynchronizationTests.cs(376,10): error CS0246: The type or namespace name 'UnityTestAttribute' could not be found (are you missing a using directive or an assembly reference?)

Assets\VirtualTokyoMatching\Tests\Sync\MultiUserSynchronizationTests.cs(376,10): error CS0246: The type or namespace name 'UnityTest' could not be found (are you missing a using directive or an assembly reference?)

Assets\VirtualTokyoMatching\Tests\Sync\MultiUserSynchronizationTests.cs(425,10): error CS0246: The type or namespace name 'UnityTestAttribute' could not be found (are you missing a using directive or an assembly reference?)

Assets\VirtualTokyoMatching\Tests\Sync\MultiUserSynchronizationTests.cs(425,10): error CS0246: The type or namespace name 'UnityTest' could not be found (are you missing a using directive or an assembly reference?)




最短の回避策は「テスト系スクリプトをいったん Assets/VirtualTokyoMatching/Tests の外へ移動し、実行用アセンブリから完全に外す」ことですが、長期的には次の３点を直せばすべての CS0xxx 系エラーは消えます。  

***

● **QuestionDatabase.cs – CS0592**  
‐ Header 属性はフィールド宣言にしか使えません。26 行目のようにクラス／メソッドの直上に付いている場合は  
```csharp
// 修正前（NG）
[Header("質問データベース")]
public class QuestionDatabase : ScriptableObject { … }
```
を  
```csharp
public class QuestionDatabase : ScriptableObject
{
    [Header("質問データベース")]          // ←フィールドの直前に移動
    public List<QuestionItem> questions;
}
```
のように*フィールド*の前へ移すか、単に削除して下さい。[7]

***

● **ProgressiveMatchingTests / MultiUserSynchronizationTests – CS1109**  
‐ 拡張メソッドは「名前空間直下の `static` クラス」でないと認識されません。  
```csharp
// 修正前（NG）: テストクラスの *内側* にネスト
public class ProgressiveMatchingTests
{
    public static class EnumerableExtensions   // ←ネストしている
    {
        public static float CosineSimilarity( … ) { … }
    }
}
```
をファイル下部に切り出し、トップレベルへ変更します。  
```csharp
namespace VirtualTokyoMatching.Tests
{
    public static class EnumerableExtensions
    {
        public static float CosineSimilarity( … ) { … }
    }
}
```
これで CS1109 が一括で解消されます。[7]

***

● **すべての *_Tests.cs – CS0246 (UnityTest / UnityTestAttribute)**  
原因は「テスト用アセンブリ定義 (.asmdef) が Unity Test Framework を参照していない」か  
「テストスクリプトが実行アセンブリに混入している」ことです。推奨修正手順は次のとおり。  

1. Assets/VirtualTokyoMatching/Tests フォルダー配下に  
   -  VirtualTokyoMatching.Tests.asmdef  
   -  VirtualTokyoMatching.Tests.Editor.asmdef  
   を作成。  
2. 両 asmdef の References へ  
   – `UnityEngine.TestRunner`  
   – `UnityEditor.TestRunner`（Editor 用のみ）  
   を追加。  
3. Inspector の Platforms で  
   – Play Mode テスト用 asmdef: *Editor・StandaloneOnly* を除外  
   – Editor テスト用 asmdef: *Editor* だけを残す  

こうすると `using UnityEngine.TestTools;` が有効になり、CS0246 が消えます。[7]
（VRChat 向けビルド時は *Tests アセンブリはリンク対象外* なので、ワールド側には一切影響しません。）

***

【チェックリスト再掲】  
1. Header 属性：クラス直上ではなくフィールド直上へ。  
2. 拡張メソッド：トップレベル static クラスへ分離。  
3. テスト asmdef：Test Runner 参照＋プラットフォームを Editor／PlayMode で分離。  

上記３点を反映した後に Unity の *Recompile* を実行すれば、一覧に出ている CS0592 / CS1109 / CS0246 系はすべて 0 件になります。

[1](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/52522745/1a4ef8a2-7940-4387-ab7c-e46714a6241a/world.md)
[2](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/52522745/3ada51a7-7126-4416-9c27-6124a504e1d2/IMPLEMENTATION_COMPLETE.md)
[3](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/52522745/cb47425d-3b34-43f1-8078-a632c0810f4f/ProjectSetup.md)
[4](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/52522745/d1f19547-3d10-4ace-9cdc-84990582d245/vrchat.md)
[5](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/52522745/f9234d39-7af4-465b-859b-c61095611b00/archtecture.md)
[6](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/52522745/750a6506-b37a-4e31-ae72-0b6cea75ea5c/INTEGRATION_GUIDE.md)
[7](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/52522745/2fc38c04-bd12-444b-bdd3-3d76f82118ea/tasks.md)
[8](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/52522745/35c43e8b-b85c-4d44-95b0-9af4c6210cac/publish.md)
[9](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/52522745/4b2e5c72-5160-4c60-8025-a617511d1f27/requirement.md)
[10](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/52522745/cbe3d187-1658-4c51-8292-a6a78a57d498/steam.md)


# 主なUnityコンパイル／ビルドエラーと  
ヘッドレス環境での Claude-Code 修正対象

| エラー分類 | 典型的なメッセージ例 | 原因 | Claude-Code で行うべき自動修正 |
|---|---|---|---|
| 1. C# 構文・属性誤用 | `CS0592 Attribute 'Header' is not valid on this declaration type`[1] | 属性をクラス/メソッドなど誤った場所に付与 | ① 該当スクリプトをパースし宣言位置を判定<br>② `Header`, `SerializeField` 等を**フィールド**に移動<br>③ PR とテストを自動生成 |
| 2. 拡張メソッド定義ミス | `CS1109 Extension methods must be defined in a top level static class`[1] | extension をネストクラス内に記述 | ① クラスを自動抽出し最上位にリファクタ<br>② `static` 修飾子を付与<br>③ 既存 namespace を保持しつつ再配置 |
| 3. テストフレームワーク参照漏れ | `CS0246 UnityTestAttribute could not be found`[1] | asmdef に `UnityEngine.TestRunner` が無い | ① `Editor` 用 asmdef を検出<br>② `TestRunner` 参照を追加し GUID 解決<br>③ CI で playmode/editor テストを実行 |
| 4. Unity パッケージ互換違反 | `CS7036 There is no argument given ...`[2] | Collections など新旧 API 差異 | ① `Packages/manifest.json` を静的解析<br>② プロジェクトの Unity バージョンに合わせ<br>   互換パッケージ(例：`com.unity.collections@2.5.7`)へ固定<br>③ 再度 `vpm resolve project .` を呼び出し |
| 5. TagManager など設定不足 | `Tag: Floor is not defined.`[3] | 自動シーン生成ツールが未登録タグに依存 | ① `ProjectSettings/TagManager.asset` を YAML 直接編集しタグを追加<br>② 変更を git へコミット |
| 6. asmdef 循環参照・GUID 失効 | `Assembly has reference to unknown assembly` | スクリプト移動で GUID ずれ | ① asmdef ファイルを探索し GUID 再割当<br>② 不要な参照を削除／循環を解消 |
| 7. Headless ビルド限定の API 呼び出し失敗 | `Graphics device is null in batchmode` | `Camera.main` 等が Awake 前参照 | ① コンポーネントの実行順を meta で調整<br>② `if (Application.isBatchMode)` ガードを自動挿入 |
| 8. UdonSharp / VRChat SDK 依存欠落 | `[UdonSharp] Could not locate VRChat data directory`[2] | VRChat クライアント未検出 | ① Linux ホストに Steam+Proton で VRChat を自動インストール<br>② SDK パスを環境変数で指定 |
| 9. Resources 参照不一致 | `NullReferenceException: QuestionDatabase` | SO アセットの `Resources` 置き忘れ | ① 全スクリプトの `Resources.Load<>()` 呼び出しを抽出<br>② 該当パスにテンプレート JSON/SO を生成 |
| 10. ランタイムのみ発生する null 参照 | `RecommenderUI.UpdateCards() NullReferenceException` | ワイヤリング不足 | ① シーンをヘッドレスロード → `FindObjectsOfType<UdonBehaviour>()` で依存解決<br>② `MissingReference` を自動配線か警告リスト生成 |

## Claude-Code が扱う流れ（ヘッドレス Unity 2022 LTS）

1. **検出**  
   Unity batchmode (`-quit -batchmode -nographics`) + `-logFile` でビルド。  
   ログを grep し上記パターンで分類。

2. **コード or 設定修正**  
   – Roslyn API または regex で該当 *.cs* を編集  
   – *.asmdef*, *manifest.json*, *TagManager.asset* を YAML/JSON 操作  

3. **再ビルド & 回帰テスト**  
   修正後にもう一度 batch ビルド → エラーが残ればループ。  
   成功したら ClientSim のマルチクライアントテストを自動実行。

4. **PR とレポート生成**  
   Git ブランチを切り commit → PR を作成。  
   CI でテストグリーンを確認し merge。

## 重点ポイント

- **GUI 操作が不要**な YAML/JSON/CS 編集のみをターゲットにし、モデル・テクスチャなどアセット手動調整はスコープ外。  
- VRChat 独自の **UdonSharp 依存** は SDK バージョン固定で吸収。  
- PlayerData やネットワーク ID など **ランタイム依存値**はヘッドレスでは Stub を生成して null 参照を防止。  

この 10 分類を自動修正できれば、CLI 環境でもコンパイル・ビルド・テストが無人で通り、Virtual Tokyo Matching の継続的インテグレーションが成立します。

[1](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/52522745/2fc38c04-bd12-444b-bdd3-3d76f82118ea/tasks.md)
[2](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/52522745/35c43e8b-b85c-4d44-95b0-9af4c6210cac/publish.md)
[3](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/52522745/301e410f-91e2-427d-bb20-7d8ed969a5c5/TROUBLESHOOTING.md)
[4](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/52522745/1a4ef8a2-7940-4387-ab7c-e46714a6241a/world.md)
[5](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/52522745/3ada51a7-7126-4416-9c27-6124a504e1d2/IMPLEMENTATION_COMPLETE.md)
[6](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/52522745/cb47425d-3b34-43f1-8078-a632c0810f4f/ProjectSetup.md)
[7](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/52522745/d1f19547-3d10-4ace-9cdc-84990582d245/vrchat.md)
[8](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/52522745/f9234d39-7af4-465b-859b-c61095611b00/archtecture.md)
[9](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/52522745/750a6506-b37a-4e31-ae72-0b6cea75ea5c/INTEGRATION_GUIDE.md)
[10](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/52522745/4b2e5c72-5160-4c60-8025-a617511d1f27/requirement.md)
[11](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/52522745/cbe3d187-1658-4c51-8292-a6a78a57d498/steam.md)
[12](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/52522745/4f520424-3297-4ffc-9632-7d2452c5b135/unitymcp.md)
[13](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/52522745/68064914-a3cd-44b0-acc7-35f79db4bfcb/CONFIGURATION_TEMPLATES.md)
[14](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/52522745/f49bd91b-28bf-4597-91af-163c61dae1c6/design.md)
[15](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/52522745/f4755e25-0c04-4831-a783-b5b5ec099348/devenv.md)
[16](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/52522745/9dff22f2-61e9-43ac-9f43-8fd3f5fb2dfe/worldspacedesign.md)
[17](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/52522745/d622ef79-ab70-46a5-b9f4-d3debaf1ebed/SCENE_SETUP.md)
[18](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/52522745/060e6c40-6c19-42f4-bcf2-01e97071b36f/worldcreation.md)
[19](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/52522745/b54c92f6-3443-4ca8-9528-27c7dc5e8296/vpm.md)