## 目的と適用範囲
- 目的は、入口・広間（ロビー）・個室・バックヤードを最小構成で実装し、イベント駆動のマッチング体験を安定提供するための空間規約を定義することにある。[2][1]
- 適用範囲はTransform/テレポート導線、Station/占有、遮音・視界分離、同期/所有権、Quest最適化、復旧/安全UI、デバッグ可視化を含むが、アセット制作や外部サービス連携は含まない。[5][3]

## ゾーニング
- 入口（Entrance Gate）→広間（Lobby）→個室群（Private Rooms）→帰還（Return Point）を基本動線とし、バックヤード（運用/計測HUD）は一般利用者から不可視に配置する。[1][2]
- 個室は占有中の遮音・視界遮蔽を優先し、ロビーは5ボタン（開始/続きから/公開ON-OFF/おすすめを見る/個室へ直行）と推薦UIに特化したミニマル構成とする。[3][2]

## 出入口（Entrance）
- 初回入室はスポーン直後に同意・年齢・ポリシー提示の立て看板または壁面UIへ案内し、同意後にロビーへテレポートさせる（誤操作防止に二段階確認）。[2][3]
- 落下/迷子に備え、足下に安全床（広コライダー）と周辺にRespawnボリューム相当の復帰トリガーを置き、無限ループ防止のクールダウンを導入する。[6][1]

## 広間（Lobby）
- ロビー中央に5ボタンUI、側面に推薦カードと進捗表示、奥に1on1導線を配置し、視線移動だけで主要行為が完結する視界設計とする（自由記述は置かない）。[3][2]
- ロビーは描画コストを最小化（焼き込みライト・低コストシェーダ・限定的なパーティクル）し、個室群と視界分離・オクルージョンで相互負荷干渉を避ける。[5][2]

## 個室（Private Rooms）
- 個室は入室同意→割当→テレポート→15分タイマー→終了ベル→帰還の最短導線を満たし、入室後はドア/壁コライダーで第三者侵入を物理的に遮断する。[1][2]
- 座席/立位の安定にはStation併用やフロアの滑り止め設計を用い、終了・片方離脱・クラッシュ時はタイムアウト解放とロビー帰還を標準挙動とする（自動クリーンアップ）。[2][1]

## テレポートと位置安全
- 招待同意後やフロー遷移はVRCPlayerApiを用いたTeleportToで行い、ターゲットアンカーは命名規約（E_*, L_*, R_*）を設けて誤送を防止する。[6][2]
- テレポート・トリガーは一回限り発火＋クールダウンで多重遷移を抑止し、異常位置（外周/床抜け）検知時はRespawnでセルフヒールさせる。[6][1]

## 所有権と同期（空間側）
- 占有中の個室制御・タイマー・ベル・表示は各個室のOwnerを明確化し、SetOwnerの発火点と再同期のOnDeserialization適用順をガイド化する（初期化はOnPlayerJoined後）。[4][1]
- RequestSerializationはイベントバッチ化しレート制御を設け、red/tags/headline等の同期ペイロード合計を帯域予算内へ抑制する（小さい方を選ぶ設計）。[7][2]

## 遮音・視界分離
- 個室の音漏れ抑制は距離減衰設定・遮音壁配置・音源範囲設計の併用で行い、ベル音は個室内限定に配置する（ロビー重畳を回避）。[1][2]
- 視界分離は部屋ごとに壁/曲面/カーテンで行い、レンダラーのオン/オフは領域ベースで切替えて無駄なドローを避ける（ロビーから個室内部が見えない造作）。[5][2]

## 進入制御と占有管理
- 個室は状態（空/予約/占有/解放）をネットワーク同期オブジェクトで管理し、同時招待の競合は優先順位と短いリトライで解消する（満室時はロビーで待機）。[2][1]
- 招待拒否/ブロック時は強制的にロビー固定点へ復帰し、誘導連打はクールダウンで抑制する（安全UI常時露出）。[3][2]

## Late-joiner整合
- 初期描画は同期完了後（OnPlayerJoined→OnDeserialization）に行い、ランキング/UIは未同期中はプレースホルダで明示する（ちらつき回避）。[4][1]
- 個室占有情報・タイマー残り時間・公開可否の表示は再入室時に原子的に再構築し、ズレ時は安全側（公開OFF・ロビー退避）に倒す。[3][2]

## Quest最適化（空間別予算）
- Quest互換を前提に、ロビーは低ドロー・低ライト・低テクスチャ解像度、個室は閉鎖空間でオクルージョン有利な構造でメモリとドローを抑える（容量<100MB目標）。[8][3]
- テクスチャはプラットフォーム別インポータで上限圧縮、焼き込みライト＋モバイル系シェーダ＋ミップ/ストリーミングを既定とし、CIで容量・バリアント・ドロー差分を検査する。[8][5]

## アクセシビリティ/操作性
- 重要操作（公開ON/OFF・招待・退出）はピクト＋文言＋色の多重表現とし、デスクトップ/VR双方でレーザー/クリック/近接トリガの操作性を確保する。[2][3]
- 一部UIはワールドスペースで視距離最適化（読みやすいサイズ/コントラスト）し、誤操作防止に長押し/二段階確認を採用する。[3][2]

## 安全/モデレーション表現
- ミュート/ブロック/通報の導線はロビーと個室の双方に常設し、公開OFF時は露出ゼロを実空間レベルでも保証する（表示・サインの即時消去）。[1][2]
- 年齢適合と行動規範は入口とロビーに掲示し、セッション中の撮影/配信注意は個室入口に掲示して同意撤回時は即遮断する設計とする。[1][3]

## デバッグ/運用HUD（テスト版限定）
- 在室/公開者数、再計算キュー長、平均相性算出時間、K値、同期送出回数を簡易HUDで表示し、テスト版のみ表示フラグで切替える。[5][1]
- 個室占有状況とテレポート発火ログ、落下検出カウンタ、帯域低下時の送信間引き発生回数を可視化してボトルネックを早期発見する。[7][1]

## 命名/レイヤ/アンカー規約
- アンカーはE_*（入口）/L_*（ロビー）/R_*（個室n）/X_*（帰還）で命名し、テレポ先は床面法線・天井高・回頭角を含むメタをドキュメント化する。[6][2]
- コライダー/トリガ/壁は用途別レイヤで分離し、個室壁は遮音・視界・物理の三要件を満たすマテリアル設定を既定化する。[2][1]

## 同期/帯域の空間的最適化
- 個室ごとにPublicProfilePublisher/タイマーなどの同期ポイントを局所化し、ロビー側更新と干渉しないようRequestSerializationの時間窓を分離する。[1][2]
- red/tags/headlineの同期頻度は回答確定・公開切替・入退室に限定し、帯域制約下では優先度付きで招待/占有更新を先に送る。[7][2]

## テスト項目（位置/空間系）
- 広間⇄個室テレポ連鎖の多重発火防止、Station乗降、遮音ゾーンの音漏れ、満室/同時招待競合、Late-joiner復元、落下/外周逸脱時の自動復帰をPC/Questで再現試験する。[5][2]
- 入口同意→ロビー→個室→帰還の全行程でフレームタイム・送信回数・再計算遅延を採取し、閾値超過時にビルドを止める品質ゲートへ連携する。[4][3]

## 付記（実装ヒント）
- UdonSharpでの位置操作はVRCPlayerApi.TeleportTo/Respawn、状態同期はOnDeserializationで差分適用、所有権はSetOwner直後のフレーム副作用を避ける実装が安定する。[4][6]
- Udon帯域は理論値より低く頭打ちする事例があるため、同期ペイロードは最小・低頻度・バッチ化で設計する（サイズ/頻度の両方を抑制）。[7][2]